# Default configuration settings applied globally
defaults:
  # Path to the pfctl binary executable
  pfctlBinary: /sbin/pfctl

# AuthPF-specific configuration
authpf:
  # AuthPF anchor activity timeout (e.g., 30m, 1h)
  timeout: 30m

  # Root directory where user-specific rule files are stored
  userRulesRootfolder: /etc/authpf/users

  # Filename for user rules within the userRulesRootfolder
  userRulesFile: authpf.rules

  # Name of the PF anchor to use for rule management
  anchorName: authpf

  # Set flush targets for pfctl command
  flushFilter:
    - nat
    - queue
    - ethernet
    - rules
    - info
    - Sources
    - Reset

  # Flush anchors on startup API. 
  # Two options available: import and importflush.
  # - import: only import existing anchors in authpf/ (default anchorbase, see: anchorName) 
  #     Parse format is: user(UserID)
  #     Example: "authpf/user(2000)" will import, "authpf/user" will not import
  # - importflush: same as import but in addition it remove all anchors to get a clean state for startup
  #
  # Limitations with import:
  #   1. It is current not possible to detect the UserIP. The UserIP will set to "NaN/imported". It does not have any effect.
  #   2. The Expire Datetime will calculate by the `authpf.timeout` and current server time.
  #
  onStartup: importflush # none, import, importflush

# Server configuration
server:
  # IP address to bind the server to (127.0.0.1 for localhost only)
  bind: 127.0.0.1

  # Port number for the HTTP/HTTPS server
  port: 8080

  # SSL/TLS configuration
  ssl:
    # Path to SSL certificate file (leave empty to disable SSL)
    certificate: 
    # Path to SSL private key file
    key: key.pem

  # JWT secret key for token signing - MUST be changed before production deployment
  jwtSecret: your-secret-key-change-in-production

  # JWT token timeout in hours (default: 8 hours if not set)
  # Supported formats when used in code: 30m, 1h, 2d (maximal 30 days)
  # Configuration value is in hours (integer)
  jwtTokenTimeout: 8

  # Elevator mode for privilege escalation (none, sudo, or doas)
  # Required when running server as non-root user (recommended)
  # 
  # Examples:
  #
  # sudo:
  #   Cmnd_Alias AUTHPF_API_COMMANDS = /sbin/pfctl -sA, \
        /sbin/pfctl ^-a authpf/([a-zA-Z0-9_-]+)(\([0-9]+\))? -D user_ip=[0-9.]+ -D user_id=[0-9]+ -f /etc/authpf/users/[a-zA-Z0-9_-]+/authpf.rules$, \
        /sbin/pfctl ^-a authpf/([a-zA-Z0-9_-]+)(\([0-9]+\))? -F nat$, \
        /sbin/pfctl ^-a authpf/([a-zA-Z0-9_-]+)(\([0-9]+\))? -F rules$, \
        /sbin/pfctl ^-a authpf/([a-zA-Z0-9_-]+)(\([0-9]+\))? -F queue$, \
        /sbin/pfctl ^-a authpf/([a-zA-Z0-9_-]+)(\([0-9]+\))? -F states$, \
        /sbin/pfctl ^-a authpf/([a-zA-Z0-9_-]+)(\([0-9]+\))? -F Tables$, \
        /sbin/pfctl ^-a authpf/([a-zA-Z0-9_-]+)(\([0-9]+\))? -F all$
  #   %_authpf-api ALL=(root)  NOPASSWD: AUTHPF_API_COMMANDS
  #
  # doas:
  #   # No regular expression for arguments available
  #   permit nopass :authpf as root cmd /sbin/pfctl 
  #
  #   # More secure, use wrapper script for pfctl (see scripts/pfctl_wrapper.go)
  #   # in authpf-api.conf set: defaults.pfctlBinary to /usr/local/sbin/pfctl_wrapper
  #   permit nopass :authpf as root cmd /usr/local/sbin/pfctl_wrapper
  #
  elevatorMode: none

  # Path to the server logfile
  logfile: /var/log/authpf-api.log

# Role-Based Access Control (RBAC) configuration
rbac:
  # Role definitions with associated permissions
  roles:
    # Administrator role with full permissions
    admin:
      permissions:
        - deactivate_other_rules  # Allow user to activate their own rules
        - deactivate_own_rules    # Allow user to activate rules from other users
        - view_other_rules        # Allow user to view the status of their own loaded rules
        - view_own_rules          # Allow user to view the status of loaded rules from all users
        - activate_other_rules    # Allow user to unload/deactivate their own rules
        - activate_own_rules      # Allow user to unload/deactivate rules from other users
    # Regular user role with limited permissions
    user:
      permissions:
        - activate_own_rules
        - deactivate_own_rules
        - view_own_rules
  
  # User account definitions with credentials and role assignments
  users:
    # Administrator test account
    authpf-admin:
      # password hash (generate: echo -n "testing" | authpf-api -gen-user-password)
      password: $2a$10$abcdefg.....
      # Role assigned to this user
      role: admin
      # Numeric user ID
      userId: 1000
    # Example User
    authpf-user1:
      # password hash (generate: echo -n "testing" | authpf-api -gen-user-password)
      password: $2a$10$hijklmni.....
      # Role assigned to this user
      role: user
      # Numeric user ID (optional - defaults to 0 if not set)
      # userId: 1001
